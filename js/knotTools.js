function gaussCode(intersectionWatcher) {
    const indices = intersectionWatcher[3].map((_, index) => index);
    indices.sort((indexA, indexB) => intersectionWatcher[3][indexA] - intersectionWatcher[3][indexB]);

	var out = new Array(intersectionWatcher[2].length);
	var i = 0;
	var j = 0;
	for (var k = 0; k < 2 * intersectionWatcher[2].length; k++) {
		if (intersectionWatcher[2][i] < intersectionWatcher[3][indices[j]]) {
			out[k] = (i+1)*(intersectionWatcher[1][i] ? 1 : -1);
			i += 1;
		}
		else {
			out[k] = (j+1)*(intersectionWatcher[1][indices[j]] ? -1 : 1);
			j += 1;
		}
	}
	return out;
}

function dowkerThistlethwaiteCodeDebug(intersectionWatcher) {
	const indices = intersectionWatcher[3].map((_, index) => index);
    indices.sort((indexA, indexB) => intersectionWatcher[3][indexA] - intersectionWatcher[3][indexB]);

	var out = new Array(intersectionWatcher[3].length);

	var i = 0;
	var j = 0;
	for (var k = 0; k < 2 * intersectionWatcher[2].length; k++) {
		if (intersectionWatcher[2][i] < intersectionWatcher[3][indices[j]]) {
            if (k % 2 == 1) {
                out[i] = (k+1)*(intersectionWatcher[1][i] ? 1 : -1);
            }
            i += 1;
		} else {
            if (k % 2 == 1) {
			    out[indices[j]] = (k+1)*(intersectionWatcher[1][indices[j]] ? -1 : 1);
            }
            j += 1;
		}
	}

	return out;
}

function dowkerThistlethwaiteCode(intersectionWatcher) {
	const indices = intersectionWatcher[3].map((_, index) => index);
    indices.sort((indexA, indexB) => intersectionWatcher[3][indexA] - intersectionWatcher[3][indexB]);

	var out = [];
	for (var k = 0; k < intersectionWatcher[2].length; k++) {
		out.push([,]);
	}
	var i = 0;
	var j = 0;
	for (var k = 0; k < 2 * intersectionWatcher[2].length; k++) {
		if (intersectionWatcher[2][i] < intersectionWatcher[3][indices[j]]) {
			out[i][k % 2] = (k+1)*(k % 2 == 1 && !intersectionWatcher[1][i] ? -1 : 1);
			i += 1;
		} else {
			out[indices[j]][k % 2] = (k+1)*(k % 2 == 1 && intersectionWatcher[1][indices[j]] ? -1 : 1);
			j += 1;
		}
	}

    out.sort((a, b) => a[0] - b[0]);
	return out.map(sub => sub[1]);
}

function alexanderPolynomial(intersectionWatcher, activeKnot) { // Calculates the Alexander Polynomial of the selected knot.
	intersections = activeKnot.getCrossings(activeKnot);
	if (intersections.length == 0) {
		return [1];
	}
	underTimes = [];

	for (var i = 0; i < intersections.length; i++) {
			var intersect = intersections[i];
			if (intersectionWatcher[1][i]) {
				underTimes.push(intersect.time + intersect.index);
			}
			else {
				underTimes.push(intersect.intersection.time + intersect.intersection.index);
			}
	}
	underTimes.sort(function(a, b){return a-b});

	function getStrand(time) {
		if (time <= underTimes[0] || time > underTimes[underTimes.length - 1]) {
			return 0;
		}
		for (var k = 1; k < underTimes.length; k++) {
			if (time <= underTimes[k]) {
				return k;
			}
		}
	}

	matrix = [];
	for (var i = 0; i < intersections.length -1; i++) {
		var intersect = intersections[i];
		over = getStrand(intersect.time + intersect.index);
		under1 = getStrand(intersect.intersection.time + intersect.intersection.index);

		// Swap over and under depending on whether the crossing goes over or under
		if (intersectionWatcher[1][i]) {
			over = [under1, under1 = over][0];
		}
		under2 = (under1 + 1) % (intersections.length);

		// The entries swap if the crossing is left or right handed
		var inverted = intersect.tangent.cross(intersect.intersection.tangent) < 0;
		if (intersectionWatcher[1][i]) under2 = [under1, under1 = under2][0];
		if (inverted) {under2 = [under1, under1 = under2][0];}
		row = Array(intersections.length).fill(0);
		row[over] += polyToInt([1,-1]);
		row[under1] += polyToInt([-1]);
		row[under2] += polyToInt([0,1]);
		matrix.push(row.slice(0,intersections.length - 1));
	}

	var polynomial = intToPoly(det(matrix));
	var out = [];
	var flag = 0;
	for (var k = 0; k < polynomial.length; k++) {
		var coeff = polynomial[k];
		if (flag == 0) {
			if (coeff != 0) {
				flag = coeff > 0 ? 1 : -1;
				out.push(flag * coeff);
			}
		} else {
			out.push(flag * coeff);
		}
	}

	return out;
}

function alexanderString(p) { // Returns a MathJax string displaying the Alexander polynomial.
	var out = "\\( p(t) = ";
	var l = p.length;
	for (var k = 0; k < l; k++) {
		var coeff = p[k];
		if (coeff == 0) {continue;}
		var exponent = (l - 1) / 2 - k;
		out += (coeff > 0 && k != 0 ? "+" : "");
		out += coeff.toString();
		out += exponent != 0 ? "t^{" + exponent.toString() + "}" : "";
	}
	out += "\\)";
	return out
}

// From https://github.com/joshuahhh/knot-identification-tool/blob/master/kit.coffee
// under MIT
// Courtesy of Alexander Stoimenow and Joshua Horowitz
knotEncyclopedia = {"1": [["0_1"]], "1,-5,9,-11,9,-5,1": [["9_20"], ["10_149"]], "2,-9,21,-27,21,-9,2": [["10_95"]], "1,-3,6,-8,9,-8,6,-3,1": [["10_62"]], "2,-10,20,-25,20,-10,2": [["10_92"]], "1,-4,7,-9,7,-4,1": [["3_1", "6_2"]], "1,-5,11,-17,19,-17,11,-5,1": [["10_112"]], "1,-7,18,-23,18,-7,1": [["9_40"], ["10_59"]], "1,-3,6,-7,7,-7,6,-3,1": [["10_47"]], "4,-12,15,-12,4": [["10_16"]], "1,-1,0,1,-1,1,0,-1,1": [["10_124"]], "1,-5,9,-5,1": [["7_7"]], "2,-3,3,-3,2": [["7_3"]], "2,-7,11,-7,2": [["8_13"]], "1,-6,15,-24,29,-24,15,-6,1": [["10_123"]], "2,-6,7,-6,2": [["8_6"]], "2,-3,2,-1,2,-3,2": [["10_142"]], "3,-9,16,-19,16,-9,3": [["10_66"]], "1,-2,4,-5,4,-2,1": [["10_126"]], "7,-21,29,-21,7": [["10_101"]], "4,-11,13,-11,4": [["10_11"]], "2,-10,17,-10,2": [["9_19"]], "2,-10,21,-27,21,-10,2": [["10_114"]], "1,-1,1,-1,1,-1,1,-1,1": [["9_1"]], "1,-3,3,-3,1": [["6_2"]], "1,-4,8,-9,8,-4,1": [["8_16"], ["10_156"]], "2,-10,24,-31,24,-10,2": [["10_117"]], "2,-8,13,-8,2": [["10_146"]], "2,-7,11,-13,11,-7,2": [["10_50"]], "4,-14,19,-14,4": [["10_18"], ["10_24"]], "2,-8,16,-21,16,-8,2": [["10_102"]], "2,-5,7,-7,7,-5,2": [["5_1", "5_2"]], "1,-7,18,-25,18,-7,1": [["10_71"]], "1,-6,9,-6,1": [["9_45"]], "1,-4,8,-10,11,-10,8,-4,1": [["10_85"]], "1,-3,5,-5,5,-3,1": [["8_7"]], "2,-9,20,-25,20,-9,2": [["10_84"]], "3,-7,3": [["8_1"]], "1,-1,0,2,-3,2,0,-1,1": [["10_139"]], "1,-7,16,-19,16,-7,1": [["10_70"]], "2,-5,8,-9,8,-5,2": [["9_16"], ["3_1", "7_3"]], "1,-5,7,-7,7,-5,1": [["9_11"]], "1,-7,11,-7,1": [["9_48"]], "1,-3,5,-7,7,-7,5,-3,1": [["10_9"]], "1,-7,20,-27,20,-7,1": [["10_73"]], "1,-6,14,-17,14,-6,1": [["9_32"]], "2,-4,6,-7,6,-4,2": [["9_9"]], "3,-13,19,-13,3": [["10_36"]], "2,-6,11,-13,11,-6,2": [["3_1", "7_5"]], "2,-6,7,-7,7,-6,2": [["10_6"]], "1,-6,13,-17,13,-6,1": [["3_1", "7_6"]], "1,-4,9,-15,19,-15,9,-4,1": [["10_104"]], "4,-11,15,-11,4": [["9_23"], ["3_1", "7_4"]], "3,-14,21,-14,3": [["9_39"]], "2,-7,15,-19,15,-7,2": [["10_51"]], "2,-7,13,-15,13,-7,2": [["10_23"], ["10_52"]], "2,-9,19,-25,19,-9,2": [["10_86"]], "1,-4,8,-12,13,-12,8,-4,1": [["10_82"]], "2,-3,3,-3,3,-3,2": [["9_3"]], "1,-3,3,-3,3,-3,1": [["8_2"]], "1,-1,1,-1,1": [["5_1"], ["10_132"]], "1,-5,8,-7,8,-5,1": [["10_138"]], "2,-4,4,-3,4,-4,2": [["10_134"]], "1,-3,4,-5,4,-3,1": [["8_5"], ["10_141"]], "1,-2,2,-1,2,-2,1": [["10_125"]], "1,-5,9,-9,9,-5,1": [["9_17"]], "2,-11,26,-33,26,-11,2": [["10_113"]], "4,-10,13,-10,4": [["9_18"]], "1,1,-3,1,1": [["10_145"]], "2,-9,18,-23,18,-9,2": [["10_87"], ["10_98"]], "2,-6,10,-11,10,-6,2": [["10_12"], ["10_54"]], "1,-1,0,1,0,-1,1": [["8_19"]], "2,-4,5,-4,2": [["7_5"], ["10_130"]], "3,-5,5,-5,3": [["9_4"]], "2,-11,27,-35,27,-11,2": [["10_121"]], "4,-8,9,-8,4": [["9_10"]], "1,-1,-1,3,-1,-1,1": [["10_153"]], "1,-2,3,-2,1": [["8_20"], ["10_140"], ["3_1", "3_1"]], "1,-8,24,-35,24,-8,1": [["10_88"]], "8,-26,37,-26,8": [["10_120"]], "2,-5,2": [["6_1"], ["9_46"]], "2,-8,15,-19,15,-8,2": [["10_32"]], "1,-6,15,-19,15,-6,1": [["3_1", "7_7"]], "6,-11,6": [["9_5"]], "2,-8,15,-17,15,-8,2": [["10_93"]], "4,-7,4": [["7_4"], ["9_2"]], "1,-7,19,-25,19,-7,1": [["10_44"]], "2,-9,16,-19,16,-9,2": [["10_72"]], "2,-7,9,-7,2": [["8_11"], ["10_147"], ["3_1", "6_1"]], "1,-7,21,-29,21,-7,1": [["10_69"]], "1,-4,10,-13,10,-4,1": [["10_151"]], "1,-5,11,-13,11,-5,1": [["9_26"]], "3,-10,13,-10,3": [["10_144"]], "4,-9,4": [["8_3"], ["10_1"]], "2,-3,1,1,1,-3,2": [["10_128"]], "2,-8,12,-13,12,-8,2": [["10_14"]], "1,-4,9,-14,15,-14,9,-4,1": [["10_94"]], "7,-13,7": [["9_35"]], "2,-9,19,-23,19,-9,2": [["10_83"]], "1,-7,22,-33,22,-7,1": [["10_96"]], "1,-6,15,-21,15,-6,1": [["4_1", "6_3"]], "1,-5,8,-9,8,-5,1": [["9_36"]], "2,-7,11,-11,11,-7,2": [["10_19"]], "2,-9,15,-9,2": [["9_14"]], "2,-5,5,-5,2": [["8_4"]], "2,-7,13,-17,13,-7,2": [["10_26"]], "5,-14,19,-14,5": [["9_38"], ["10_63"]], "3,-9,11,-9,3": [["10_20"], ["10_162"]], "3,-6,7,-6,3": [["9_49"]], "1,-4,8,-11,8,-4,1": [["8_17"]], "1,-4,10,-16,19,-16,10,-4,1": [["10_99"]], "1,-8,22,-31,22,-8,1": [["10_107"]], "3,-9,15,-17,15,-9,3": [["10_80"]], "1,-4,9,-14,17,-14,9,-4,1": [["10_91"]], "1,-7,17,-21,17,-7,1": [["10_41"]], "1,-1,1,-1,1,-1,1": [["7_1"]], "1,-5,12,-19,23,-19,12,-5,1": [["10_118"]], "1,-6,11,-6,1": [["10_137"], ["4_1", "4_1"]], "2,-9,17,-21,17,-9,2": [["10_111"]], "1,-2,3,-3,3,-3,3,-2,1": [["3_1", "7_1"]], "2,-6,9,-6,2": [["8_8"], ["10_129"]], "2,-11,19,-11,2": [["9_37"], ["4_1", "6_1"]], "1,-3,5,-5,5,-5,5,-3,1": [["10_5"]], "3,-12,19,-12,3": [["9_41"]], "1,-8,22,-29,22,-8,1": [["10_105"]], "3,-7,9,-7,3": [["9_7"]], "2,-8,11,-8,2": [["8_14"], ["9_8"], ["10_131"]], "2,-10,15,-10,2": [["9_15"], ["10_165"]], "1,-4,6,-5,6,-4,1": [["9_47"]], "1,-3,5,-7,5,-3,1": [["8_9"], ["10_155"]], "1,-9,26,-37,26,-9,1": [["10_115"]], "1,-6,16,-23,16,-6,1": [["9_34"]], "1,-3,6,-10,11,-10,6,-3,1": [["10_64"]], "1,-4,6,-7,6,-4,1": [["10_127"], ["10_150"]], "5,-22,33,-22,5": [["10_97"]], "1,-4,9,-11,9,-4,1": [["10_159"], ["3_1", "6_3"]], "1,-4,5,-5,5,-4,1": [["4_1", "5_1"]], "2,-8,14,-17,14,-8,2": [["10_25"], ["10_56"]], "1,0,-2,3,-2,0,1": [["10_161"]], "1,-1,1": [["3_1"]], "1,-8,24,-33,24,-8,1": [["10_89"]], "2,-5,6,-7,6,-5,2": [["10_61"]], "2,-8,13,-15,13,-8,2": [["10_39"]], "2,-10,23,-31,23,-10,2": [["10_119"]], "4,-12,17,-12,4": [["5_2", "5_2"]], "2,-6,10,-13,10,-6,2": [["10_22"]], "1,-3,6,-7,6,-3,1": [["8_10"], ["10_143"], ["3_1", "3_1", "3_1"]], "1,-2,3,-4,5,-4,3,-2,1": [["5_1", "5_1"]], "1,-4,4,-3,4,-4,1": [["10_160"]], "4,-16,23,-16,4": [["10_67"], ["10_74"]], "1,-7,15,-17,15,-7,1": [["10_29"]], "1,-4,7,-4,1": [["9_44"]], "3,-11,17,-11,3": [["10_10"], ["10_164"]], "1,-5,12,-17,12,-5,1": [["9_30"]], "5,-15,21,-15,5": [["10_55"]], "1,-6,13,-15,13,-6,1": [["4_1", "6_2"]], "3,-8,12,-13,12,-8,3": [["10_49"]], "1,-6,14,-19,14,-6,1": [["9_33"]], "1,-5,10,-11,10,-5,1": [["9_22"]], "1,-5,10,-13,10,-5,1": [["8_18"], ["9_24"], ["3_1", "3_1", "4_1"]], "2,-3,2": [["5_2"]], "1,-3,5,-3,1": [["6_3"]], "1,-5,13,-17,13,-5,1": [["9_31"]], "1,-5,12,-19,21,-19,12,-5,1": [["10_116"]], "1,-6,11,-13,11,-6,1": [["10_157"]], "2,-13,23,-13,2": [["10_13"]], "3,-5,3": [["7_2"]], "1,-5,11,-15,11,-5,1": [["9_27"]], "2,-8,16,-19,16,-8,2": [["10_27"]], "2,-8,17,-23,17,-8,2": [["10_90"]], "1,-3,6,-9,11,-9,6,-3,1": [["10_48"]], "2,-6,9,-9,9,-6,2": [["10_15"]], "1,-4,10,-17,21,-17,10,-4,1": [["10_109"]], "1,-3,2,-1,2,-3,1": [["9_43"]], "4,-15,21,-15,4": [["10_38"]], "2,-7,12,-15,12,-7,2": [["10_76"]], "6,-18,25,-18,6": [["10_53"]], "2,-5,7,-5,2": [["3_1", "5_2"]], "1,-7,19,-27,19,-7,1": [["10_42"], ["10_75"]], "2,-7,9,-9,9,-7,2": [["10_21"]], "4,-17,25,-17,4": [["10_30"]], "2,-4,5,-5,5,-4,2": [["9_6"]], "4,-16,25,-16,4": [["10_33"]], "3,-9,13,-9,3": [["10_34"], ["10_135"]], "2,-8,17,-21,17,-8,2": [["10_40"], ["10_103"]], "2,-5,5,-5,5,-5,2": [["10_8"]], "1,-7,20,-29,20,-7,1": [["10_60"]], "2,-12,21,-12,2": [["10_35"]], "1,-4,10,-15,10,-4,1": [["10_158"]], "1,-3,3,-3,3,-3,3,-3,1": [["10_2"]], "2,-9,13,-9,2": [["9_12"], ["4_1", "5_2"]], "1,-7,16,-21,16,-7,1": [["10_78"]], "4,-14,21,-14,4": [["10_31"], ["10_68"]], "1,-3,7,-12,15,-12,7,-3,1": [["10_79"]], "2,-8,18,-23,18,-8,2": [["10_57"]], "3,-11,15,-11,3": [["10_7"]], "4,-9,11,-9,4": [["9_13"]], "2,-7,14,-17,14,-7,2": [["10_65"], ["10_77"]], "4,-13,19,-13,4": [["10_28"], ["10_37"]], "2,-11,17,-11,2": [["9_21"]], "1,-4,9,-15,17,-15,9,-4,1": [["10_106"]], "3,-16,27,-16,3": [["10_58"]], "3,-8,11,-8,3": [["8_15"], ["3_1", "7_2"]], "2,-8,14,-15,14,-8,2": [["10_108"]], "1,-2,3,-3,3,-2,1": [["3_1", "5_1"]], "1,-3,5,-7,9,-7,5,-3,1": [["10_17"]], "1,-5,12,-15,12,-5,1": [["9_28"], ["9_29"], ["10_163"]], "1,-3,7,-9,7,-3,1": [["10_148"]], "1,-5,7,-5,1": [["7_6"], ["10_133"]], "1,-3,1": [["4_1"]], "1,-3,4,-5,5,-5,4,-3,1": [["10_46"]], "1,-1,-1,4,-5,4,-1,-1,1": [["10_152"]], "6,-13,6": [["10_3"]], "1,-4,5,-4,1": [["8_21"], ["10_136"], ["3_1", "4_1"]], "3,-12,17,-12,3": [["9_25"]], "1,0,-4,7,-4,0,1": [["10_154"]], "1,-8,20,-25,20,-8,1": [["10_110"]], "1,-7,13,-7,1": [["8_12"]], "2,-11,24,-31,24,-11,2": [["10_122"]], "1,-7,21,-31,21,-7,1": [["10_45"]], "3,-7,7,-7,3": [["10_4"]], "1,-4,9,-12,13,-12,9,-4,1": [["10_100"]], "1,-2,1,-2,1": [["9_42"]], "1,-7,17,-23,17,-7,1": [["10_43"]], "1,-8,20,-27,20,-8,1": [["10_81"]]}
